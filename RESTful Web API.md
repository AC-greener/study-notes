### RESTful Web API

API面临的问题：一旦部署，无法改变。REST架构是为了掌控变化而设计的

三大技术撑着互联网

1. URl命名
2. HTTP协议
3. HTML文档格式

思考问题

1. 为什么请求/home，是前端路由来接管呢？

#### 第一章

##### 资源和表述

通常所说的URL是一些事物的URL，比如一个产品，一个用户。用URL命名的事物的专业术语叫做资源 resource。每个URL标识一个资源，客户端向URL发送了一个HTTP请求之后，他就会收到对应资源的表述。一种以机器可读的方式对资源当前状态的说明。表述描述了资源。

##### 可寻址性

每个URL仅能代表一个资源

##### 短会话 short Session，也被称为（无状态性）

HTTP会话只维持在一次请求过程中，客户端发送请求，服务端进行响应

##### 应用状态

吧浏览器显示的每一个页面称为应用状态（application state），可以从一个应用状态转换到另一个应用状态，这个过程对应你单击一个链接或提交一个表单，不是所有状态之间的转换都是可用的

##### 连通性原则

每个网页会告诉你如何访问相邻的网页。

网络作为一整体按照联通性原则运转，也被叫做 将超媒体作为应用状态引擎，HATEOAS

**超媒体是对HTML链接、表单、标签等事物抽象出来的术语**

一个持久性的HTTP连接也不会占用一个TCP连接超过30s

#### 第二章

我们将Content-Type的值，称为实体消息体的媒体类型（media type）也被称为MIME类型，如text/html

设计API，collection+JSON标准。 content-type：application/vnd.collection+json

![1591757541972](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1591757541972.png)

#### 第三章

##### REST是一系列设计约束的集合

不是一种协议，也不是一种文件格式

万物皆可为资源，资源一般是可以保存到计算机里面的事物，如文档，，数据的一条记录，一个算法的运行结果，他们的本质都是数据流，但是资源实际上可以是任何事物，一个苹果、一个用户，唯一的条件就是每个资源必须拥有URL。从客户端的角度来看，他不关心资源是什么，因为它看不到资源，他看到的永远只是URL和表述

##### 资源状态

表述里面的数据就是资源状态，服务器发送的表述用于描述资源当前状态，客户端发送的表述用户描述客户端希望资源拥有的状态。这就是表述性状态移交。

##### 资源有多重表述方式

有一些API可以用时JSON和XML数据格式来表述同一数据。客户端可以通过HTTP头来区分这些表述（内容协商）。

##### 资源幂等性

1. 发送两次请求对资源的影响和发送一次对资源状态的影响是一样的。 DELETE请求一旦删除了，资源就会消失。 POST既不安全也不幂等
2. 幂等性的概念来自数学。零乘运算是一个幂等的。一旦你吧一个数值乘以0，再进行无限次的乘0得到的结果还是0.
3. 幂等性是一个很有用的特性，互联网不是一个可靠的网络，假设你发送一个DELETE请求，然后你的连接超时了，不知道自己的请求是否正确完成，你只需要再发送一条DELETE请求直到收到响应信息，执行多次DELETE请求和执行一次的影响是一样的。可以在不可靠的网络中反复执行这些方法

PUT：用于修改资源状态。幂等的

PATCH，也用于修改资源状态。 表述的信息量可能非常大，如果你只是想修改资源的一小部分，用PUT方法会造成极大的浪费，patch方法可以仅仅向服务器发送你想修改的那一部分，需要建立一个diff表述，并将它作为patch请求的负载数据发送给服务器

HEAD方式是轻量级版本的GET，服务器应该和处理GET方法一样处理HEAD，但是不需要发送内容实体消息体，只需要发送HTTP状态码和报文头部

LInk报头，将超媒体放入一个HTTP请求或相应的报头中

![1591774990773](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1591774990773.png)

#### 第五章

标签的rel属性，定义所链接的资源和当前资源的关系



JSON-LD让你在一个普通的JSON文档之上添加上下文，从而可以对该文档的应用语义进行说明![1591873127644](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1591873127644.png)

改善之后的

![1591873120704](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1591873120704.png)

#### 第九章 API设计流程

profile 与资源表述关联的额外语义。比如Twitter API那些可读的文档也是一种profile

以业务需求为起点，以可读的文档为终点

##### 二步骤设计流程

##### 七步骤设计流程

1. 将客户端可能香葱API中取出或放入的信息罗列出来。这些信息就是语义描述符。与这个API相关的数据都列出来，并且以层级的方式组织起来，以一个user来举例，可能需要的数据有 A list of user，A user，name,id,tel,email,permission，
   - A list of user
     - A user
       - name
       - id
       - tel
       - email
       - permission
   
2. 为API画一幅状态图。每个方框都代表一种表述，应该使用箭头讲这些表述连接起来，箭头的本质含义就是由HTTP请求触发的状态转换

   ![1592105746003](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1592105746003.png)

   ![1592105685690](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1592105685690.png)

3. 调整字段（语义描述符）的命名
   1. 不要根据数据库模式或者对象模式来决定语义描述福的名称，否则你的客户端会很依赖服务端的代码
   2. 使用一些通用的语义

4. 选择一种媒体类型MIME，大部分时候都会使用JSON，html

5. 编写一份记录你语义描述符的profile，应该解释你所有的字段含义

6. 编码实现

7. 发布

##### 设计建议

1. 资源是服务器内部实现的，客户端从来不会和某个资源进行交互。一个资源受到一个GET请求，然后会提供某种类型的表述
2. 不要使用数据库模式来作为你的API设计的基础。画状态图可以解决这个问题
3. 不要从表述格式入手
4. 标准名称优于自定义名称
5. 当你的API改变时

##### 媒体类型

1. text-uri-list URL列表

#### 11、 API中的HTTP

##### HTTP性能

1. 阻拦一些可能没有意义的请求（缓存cache）
2. 降低一般的请求开销（压缩 compression）

部分GET请求，允许客户端请求资源的一部分子集

![1592029625129](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1592029625129.png)

##### OAuth 1.0

在OAuth中，用户可以为每个客户端提供一套单独的证书，如果他决定不在使用这个客户端，他可以撤销这个客户端的证书，而其他的客户端不受任何影响。

OAuth允许开发人员集成你的API，**但是它不支持将你的API集成到桌面应用、手机应用。OAuth2.0解决了这一问题**

具体场景：

Alice进入一个网站A，发现网站可使用微信登录，Alice点击了微信登录

1. A网站偷偷的乘微信API的提供方申请了一组临时证书，这一步Alice不需要参与
2. A网站的服务器向ALice的浏览器发送了一个重定向响应，Alice停留在了微信的登录页面
3. Alice进行扫描登录之后有两个决定，确认或者不同意登录
4. Alice做出决定之后浏览器会重定向到最初的A网站
5. 如果Alice在第三步选择的是yes，网站A就被允许用他在第一步中获取的临时证书换取一组真正的令牌证书。这些证书可以用加密的方式对HTTP请求进行签名。这时，网站A就可以像Alice本人一样正常使用微信的一些API了。
6. 令牌证书可以是永久的，也可以是一定时间后自动过期





